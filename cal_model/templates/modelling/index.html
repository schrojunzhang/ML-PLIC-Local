<!--继承模板-->
{% extends 'descriptors/base.html' %}
<!--修改标题-->
{% block title %}
    <title>modelling</title>
{% endblock %}
<!--修改内容-->
<!--巨幕-->
{% block jumbotron %}
    <h1 style="margin-top: 10px">Modelling</h1>
    <p class="text-justify">
        In this module, users can choose a ML algorithm to train a customized scoring function based on the descriptors
        they submitted.
        <br><br>The dataset provided by the user is divided into the
        training set and the test set according to the ratio inputted by the user and will be preprocessed using
        <strong><em>sklearn</em></strong>.
        Three ML algorithms (i.e., eXtreme Gradient Boosting, Support Vector Machine and Random Forest) are provided.
        Users can choose a ML algorithm and do settings about hyper-parameter optimization (which hyper-parameter to be
        optimized, the hyper-parameter range, how to generate the search space and the optimization rounds). Finally,
        according to the
        user's input, the server uses <strong><em>hyperopt</em></strong> to find the optimal hyper-parameter
        combinations and chooses the
        corresponding ML algorithm for training (10-fold cross validation) and testing.
        <br><br>
        The <span class="text-primary">suggestions</span> for each set of hyper-parameters in this page and the information provided on the result page
        include <em>the model performance, the hyper-parameters of the model, the feature importance, the validation curve,
        the loss-hype_parameter scatter, the hyper_parameter-tuning_round scatter</em> offer users the directions for the
        improvement of model accuracy. And thanks to the multiple options offered by this server, users are able to
        continuously use this module to customize their models to achieve better performance.
    </p>
{% endblock %}
<!--主体内容-->
{% block content %}
    <!--任务提交-->
    <!--表单-->
    <form class="form-horizontal" action="{% url 'cal_model:modelling' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <!--基本配置行-->
        <div class="row">
            <!--面板-->
            <div class="panel panel-primary">
                <!--上传文件标题-->
                <div class="panel-heading text-center">
                    <h3 style="margin-bottom: 0;margin-top: 0">Modelling Panel</h3>
                </div>
                <!--面板体 文件上传-->
                <div class="panel-body" style="padding-top: 30px">
                    <!--左半部分-->
                    <div class="col-sm-6">
                        <!--上传描述符表单-->
                        <div class="form-group">
                            <!--标签宽度-->
                            <label for="csv-file" class="col-sm-3 control-label">Descriptor</label>
                            <!--选择框宽度-->
                            <div class="col-sm-9">
                                <!--在首尾加入符号-->
                                <div class="input-group">
                                    <!--加入符号-->
                                    <div class="input-group-addon" style="width: 60px;">.csv</div>
                                    <!--文件框-->
                                    <input id='descriptor_location' class="form-control"
                                           onclick="$('#csv-file').click();">
                                    <!--连接到选择文件按钮-->
                                    <label class="input-group-btn">
                                        <input type="button" id="i-check" value="Choose" class="btn btn-primary"
                                               onclick="$('#csv-file').click();">
                                    </label>
                                </div>
                            </div>
                            <!--选择文件按钮-->
                            <input class="form-control my_hide" type="file" name="descriptor_file" id='csv-file'
                                   accept=".csv"
                                   onchange="$('#descriptor_location').val($('#csv-file').val());" style=""
                                   required="required">
                        </div>
                        <!--上传算法表单-->
                        <div class="form-group">
                            <!--标签宽度-->
                            <label for="c-file" class="col-sm-3 control-label">Algorithm</label>
                            <!--选择框宽度-->
                            <div class="col-sm-9">
                                <!--在首尾加入符号-->
                                <select class="form-control" id='algo_select' name="algorithm">
                                    <option>eXtreme Gradient Boosting</option>
                                    <option>Support Vector Machine</option>
                                    <option>Random Forest</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <!--右半部分-->
                    <div class="col-sm-6">
                        <!--训练集比例-->
                        <div class="form-group">
                            <!--标签宽度-->
                            <label for="train_size" class="col-sm-3 control-label">Training size</label>
                            <!--选择框宽度-->
                            <div class="col-sm-9">
                                <!--在首尾加入符号-->
                                <div class="input-group" style="width: 100%;">
                                    <!--文件框-->
                                    <input type="text" class="form-control" value="0.8" aria-describedby="basic-addon2"
                                           name="train_size">
                                    <!--加入符号-->
                                    <div class="input-group-addon" style="width: 73px">(0,1]</div>
                                </div>
                            </div>
                        </div>
                        <!--Email-->
                        <div class="form-group">
                            <!--标签宽度-->
                            <label for="l-file" class="col-sm-3 control-label">Email <em>(optional)</em></label>
                            <!--选择框宽度-->
                            <div class="col-sm-9">
                                <!--在首尾加入符号-->
                                <div class="input-group" style="width: 100%">
                                    <!--文件框-->
                                    <input type="text" class="form-control" placeholder="xxx@zju.edu.cn"
                                           aria-describedby="basic-addon2" name="my_email">
                                    <!--加入符号-->
                                    <div class="input-group-addon" style="width: 73px">@</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--隐藏面板-->
                <div class="collapse in" id="my_model_parameter_table">
                    <!--数据预处理-->
                    <!--数据预处理 标题-->
                    <ul class="list-group" style="margin-bottom: 0">
                        <li class="list-group-item" style="color: #333;text-align: center;border-radius: 0">
                            <h3 style="margin: 0">Preprocessing</h3>
                        </li>
                    </ul>
                    <!--预处理面板-->
                    <div class="table-responsive">
                        <table class="table table-hover" style="margin-bottom: 0">
                            <!-- 表格标题-->
                            <tr>
                                <th style="width: 15%">type</th>
                                <th style="width: 20%">method</th>
                                <th style="width: 20%">parameter</th>
                                <th style="width: 45%">description</th>
                            </tr>
                            <!--内容-->
                            <!--数据标准化-->
                            <tr>
                                <td>Standardization</td>
                                <td>
                                    <select class="form-control" name="scaler" style="width: 80%">
                                        <option>StandardScaler</option>
                                        <option>MinMaxScaler</option>
                                        <option>MaxAbsScaler</option>
                                        <option>RobustScaler</option>
                                        <option>Normalizer</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="" name="scaler_para" disabled="disabled">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify">
                                        mean removal and variance scaling
                                        <!--蛋白修复详细介绍链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_Standardization" aria-expanded="true"
                                           aria-controls="my_detail_Standardization">
                                            [detail...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--数据标准化详细介绍-->
                            <tr class="collapse" id="my_detail_Standardization">
                                <td colspan="4">
                                    <p><strong>StandardScaler</strong>: removes the mean and scales the data to unit
                                        variance;</p>
                                    <p><strong>MinMaxScaler</strong>: rescales the data set such that all feature values
                                        are in the range [0, 1];</p>
                                    <p><strong>MaxAbsScaler</strong>: the absolute values are mapped in the range [0,
                                        1];</p>
                                    <p><strong>RobustScaler</strong>: the centering and scaling statistics of this
                                        scaler are based on percentiles and are therefore not influenced by a few number
                                        of very large marginal outliers;</p>
                                    <p><strong>Normalizer</strong>: rescales the vector for each sample to have unit
                                        norm, independently of the distribution of the samples;</p>
                                </td>
                            </tr>
                            <!--特征工程-->
                            <tr>
                                <td>Feature selection</td>
                                <td>
                                    <select class="form-control" name="feature_selector" style="width: 80%">
                                        <option>SelectFromModel</option>
                                        <option>Chi-squared</option>
                                        <option>ANOVA</option>
                                        <option>Mutual_info</option>
                                        <option>Retain_all</option>
                                    </select>
                                </td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input type="text" class="form-control" value="100"
                                                   name="feature_selector_para">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify">
                                        used for feature selection/dimensionality reduction on sample sets
                                        <!--蛋白修复详细介绍链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_Feature_selection" aria-expanded="true"
                                           aria-controls="my_detail_Feature_selection">
                                            [detail...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--特征工程详细介绍-->
                            <tr class="collapse" id="my_detail_Feature_selection">
                                <td colspan="4">
                                    <p><strong>SelectFromModel</strong>: Random Forest Classifiers are used to compute
                                        impurity-based feature importances, which in turn can be used to discard
                                        irrelevant features,the parameters means the number of tree;</p>
                                    <p><strong>Chi-squared</strong>: selecting the best features based on univariate
                                        statistical tests, the parameters means the number of selected features;</p>
                                    <p><strong>ANOVA</strong>: selecting the best features based on univariate
                                        statistical tests, the parameters means the number of selected features;</p>
                                    <p><strong>Mutual_info</strong>: selecting the best features based on univariate
                                        statistical tests, the parameters means the number of selected features;</p>
                                    <p><strong>Retain_all</strong>: no feature selection and the model will be trained
                                        with all features;</p>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <!--超参数设置-->
                    <!--超参数设置 标题-->
                    <ul class="list-group" style="margin-bottom: 0">
                        <li class="list-group-item" style="color: #333;text-align: center;border-radius: 0">
                            <h3 style="margin: 0">Setting Hyper-parameters</h3>
                        </li>
                    </ul>
                    <!--面板-->
                    <div class="table-responsive">
                        <table class="table table-hover" id="hyper_parameters">
                            <!--标题-->
                            <tr>
                                <th style="width: 15%">parameter</th>
                                <th style="width: 20%">method</th>
                                <th style="width: 20%">value range</th>
                                <th style="width: 45%">description</th>
                            </tr>
                            <!--xgb内容-->
                            <tbody class="my_hyper" id="xgb">
                            <!--寻优次数-->
                            <tr>
                                <td>tuning times</td>
                                <td><select class="form-control" disabled="disabled" style="width: 80%">
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input type="text" class="form-control" value="100" name="max_eval">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 1000]</kbd> the optimization times of hyper-parameters;
                                        <!--寻优次数建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_tuning_times" aria-expanded="true"
                                           aria-controls="mmy_detail_tuning_times">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--寻优次数建议-->
                            <tr class="collapse" id="my_detail_tuning_times">
                                <td colspan="4">
                                    <p>The larger the value, the more likely it is to find better hyper-parameters and
                                        the longer it will take;</p>
                                </td>
                            </tr>
                            <!--超参数-->
                            <!--n_estimators-->
                            <tr>
                                <td>n_estimators</td>
                                <td><select class="form-control" name="n_estimators_method" style="width: 80%">
                                    <option>uniformint</option>
                                    <option>randint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="100-300" name="n_estimators">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[1, 9999]</kbd> number of boosting rounds;
                                        <!--n_estimators建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_n_estimators" aria-expanded="true"
                                           aria-controls="mmy_detail_n_estimators">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--n_estimators建议-->
                            <tr class="collapse" id="my_detail_n_estimators">
                                <td colspan="4">
                                    <p>increasing this value will improve the learning ability of the model and the
                                        probability for model being overfitting;</p>
                                </td>
                            </tr>
                            <!--learning rate-->
                            <tr>
                                <td>learning rate</td>
                                <td><select class="form-control" name="learning_rate_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="0.01-0.3" name="learning_rate">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 1]</kbd> step size shrinkage used in update to prevents overfitting;
                                        <!--learning_rate建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_learning_rate" aria-expanded="true"
                                           aria-controls="mmy_detail_learning_rate">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--learning_rate建议-->
                            <tr class="collapse" id="my_detail_learning_rate">
                                <td colspan="4">
                                    <p>learning rate shrinks the feature weights to make the boosting process more
                                        conservative;</p>
                                </td>
                            </tr>
                            <!--subsample-->
                            <tr>
                                <td>subsample</td>
                                <td><select class="form-control" name="subsample_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="subsample">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 1]</kbd> subsample ratio of the training instances;
                                        <!--subsample建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_subsample" aria-expanded="true"
                                           aria-controls="mmy_detail_subsample">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--subsample建议-->
                            <tr class="collapse" id="my_detail_subsample">
                                <td colspan="4">
                                    <p>decreasing this value can prevent overfitting;</p>
                                </td>
                            </tr>
                            <!--max_depth-->
                            <tr>
                                <td>max depth</td>
                                <td><select class="form-control" name="max_depth_method" style="width: 80%">
                                    <option>uniformint</option>
                                    <option>randint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="3-50" name="max_depth">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[1, 9999]</kbd> Maximum depth of a tree;
                                        <!--max_depth建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_max_depth" aria-expanded="true"
                                           aria-controls="mmy_detail_max_depth">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--max_depth建议-->
                            <tr class="collapse" id="my_detail_max_depth">
                                <td colspan="4">
                                    <p>Increasing this value will make the model more complex and more likely to
                                        overfit;</p>
                                </td>
                            </tr>
                            <!--gamma-->
                            <tr>
                                <td>gamma</td>
                                <td><select class="form-control" name="gamma_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="0" name="gamma">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 9999]</kbd> Minimum loss reduction required to make a further partition
                                        on a leaf node of the tree;
                                        <!--gamma建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_gamma" aria-expanded="true"
                                           aria-controls="mmy_detail_gamma">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--gamma建议-->
                            <tr class="collapse" id="my_detail_gamma">
                                <td colspan="4">
                                    <p>The larger gamma is, the more conservative the algorithm will be;</p>
                                </td>
                            </tr>
                            <!--min_child_weight-->
                            <tr>
                                <td>min child weight</td>
                                <td><select class="form-control" name="min_child_weight_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="min_child_weight">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 9999]</kbd> Minimum sum of instance weight (hessian) needed in a child;
                                        <!--min_child_weight建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_min_child_weight" aria-expanded="true"
                                           aria-controls="mmy_detail_min_child_weight">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--min_child_weight建议-->
                            <tr class="collapse" id="my_detail_min_child_weight">
                                <td colspan="4">
                                    <p>The larger min_child_weight is, the more conservative the algorithm will be;</p>
                                </td>
                            </tr>
                            <!--colsample_bytree-->
                            <tr>
                                <td>colsample_bytree</td>
                                <td><select class="form-control" name="colsample_bytree_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="colsample_bytree">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 1]</kbd> the subsample ratio of columns when constructing each tree;
                                        <!--colsample_bytree建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_colsample_bytree" aria-expanded="true"
                                           aria-controls="mmy_detail_colsample_bytree">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--colsample_bytree建议-->
                            <tr class="collapse" id="my_detail_colsample_bytree">
                                <td colspan="4">
                                    <p>decreasing this value can prevent overfitting;;</p>
                                </td>
                            </tr>
                            <!--colsample_bylevel-->
                            <tr>
                                <td>colsample_bylevel</td>
                                <td><select class="form-control" name="colsample_bylevel_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="colsample_bylevel">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 1]</kbd> the subsample ratio of columns when constructing each level;
                                        <!--colsample_bylevel建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_colsample_bylevel" aria-expanded="true"
                                           aria-controls="mmy_detail_colsample_bylevel">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--colsample_bylevel建议-->
                            <tr class="collapse" id="my_detail_colsample_bylevel">
                                <td colspan="4">
                                    <p>decreasing this value can prevent overfitting;</p>
                                </td>
                            </tr>
                            <!--colsample_bynode-->
                            <tr>
                                <td>colsample_bynode</td>
                                <td><select class="form-control" name="colsample_bynode_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="colsample_bynode">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 1]</kbd> the subsample ratio of columns when constructing each
                                        node(split);
                                        <!--colsample_bynode建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_colsample_bynode" aria-expanded="true"
                                           aria-controls="mmy_detail_colsample_bynode">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--colsample_bynode建议-->
                            <tr class="collapse" id="my_detail_colsample_bynode">
                                <td colspan="4">
                                    <p>decreasing this value can prevent overfitting;</p>
                                </td>
                            </tr>
                            <!--reg_alpha-->
                            <tr>
                                <td>alpha</td>
                                <td><select class="form-control" name="reg_alpha_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="0" name="reg_alpha">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 9999]</kbd> L1 regularization term on weights;
                                        <!--reg_alpha建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_reg_alpha" aria-expanded="true"
                                           aria-controls="mmy_detail_reg_alpha">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--reg_alpha建议-->
                            <tr class="collapse" id="my_detail_reg_alpha">
                                <td colspan="4">
                                    <p>Increasing this value will make model more conservative;</p>
                                </td>
                            </tr>
                            <!--reg_lambda-->
                            <tr>
                                <td>lambda</td>
                                <td><select class="form-control" name="reg_lambda_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="reg_lambda">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 9999]</kbd> L1 regularization term on weights;
                                        <!--reg_lambda建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_reg_lambda" aria-expanded="true"
                                           aria-controls="mmy_detail_reg_lambda">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--reg_lambda建议-->
                            <tr class="collapse" id="my_detail_reg_lambda">
                                <td colspan="4">
                                    <p>Increasing this value will make model more conservative;</p>
                                </td>
                            </tr>
                            </tbody>
                            <!--svm内容-->
                            <tbody class="my_hyper" id="svm">
                            <!--寻优次数-->
                            <tr>
                                <td>tuning times</td>
                                <td><select class="form-control" disabled="disabled" style="width: 80%">
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input type="text" class="form-control" value="100" name="max_eval">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 1000]</kbd> the optimization times of hyper-parameters;
                                        <!--寻优次数建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_svm_tuning_times" aria-expanded="true"
                                           aria-controls="mmy_detail_svm_tuning_times">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--寻优次数建议-->
                            <tr class="collapse" id="my_detail_svm_tuning_times">
                                <td colspan="4">
                                    <p>the larger the value is, the bigger probability of finding the best
                                        hyper-parameters;</p>
                                </td>
                            </tr>
                            <!--超参数-->
                            <!--C-->
                            <tr>
                                <td>C</td>
                                <td><select class="form-control" name="C_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="0.1-10" name="C">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 9999]</kbd> Regularization parameter;
                                        <!--C建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_C" aria-expanded="true"
                                           aria-controls="mmy_detail_C">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--C建议-->
                            <tr class="collapse" id="my_detail_C">
                                <td colspan="4">
                                    <p>Increasing this value will make model more conservative;</p>
                                </td>
                            </tr>
                            <!--gamma-->
                            <tr>
                                <td>gamma</td>
                                <td><select class="form-control" name="gamma_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="0.001-1" name="gamma">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>(0, 9999]</kbd> Kernel coefficient;
                                        <!--gamma建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_svm_gamma" aria-expanded="true"
                                           aria-controls="mmy_detail_svm_gamma">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--gamma建议-->
                            <tr class="collapse" id="my_detail_svm_gamma">
                                <td colspan="4">
                                    <p>None;</p>
                                </td>
                            </tr>
                            </tbody>
                            <!--rf内容-->
                            <tbody class="my_hyper" id="rf">
                            <!--寻优次数-->
                            <tr>
                                <td>tuning times</td>
                                <td><select class="form-control" disabled="disabled" style="width: 80%">
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input type="text" class="form-control" value="100" name="max_eval">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 1000]</kbd> the optimization times of hyper-parameters;
                                        <!--寻优次数建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_rf_tuning_times" aria-expanded="true"
                                           aria-controls="mmy_detail_rf_tuning_times">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--寻优次数建议-->
                            <tr class="collapse" id="my_detail_rf_tuning_times">
                                <td colspan="4">
                                    <p>the larger the value is, the bigger probability of finding the best
                                        hyper-parameters;</p>
                                </td>
                            </tr>
                            <!--超参数-->
                            <!--n_estimators-->
                            <tr>
                                <td>n_estimators</td>
                                <td><select class="form-control" name="n_estimators_method" style="width: 80%">
                                    <option>uniformint</option>
                                    <option>randint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="100-300" name="n_estimators">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[1, 9999]</kbd> the number of trees in the forest;
                                        <!--n_estimators建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_rf_n_estimators" aria-expanded="true"
                                           aria-controls="mmy_detail_rf_n_estimators">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--n_estimators建议-->
                            <tr class="collapse" id="my_detail_rf_n_estimators">
                                <td colspan="4">
                                    <p>increasing this value will improve the learning ability of the model and the
                                        probability for model being overfitting;</p>
                                </td>
                            </tr>
                            <!--max_depth-->
                            <tr>
                                <td>max depth</td>
                                <td><select class="form-control" name="max_depth_method" style="width: 80%">
                                    <option>uniformint</option>
                                    <option>randint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="3-50" name="max_depth">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[1, 9999]</kbd> Maximum depth of a tree;
                                        <!--max_depth建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_rf_max_depth" aria-expanded="true"
                                           aria-controls="my_detail_rf_max_depth">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--max_depth建议-->
                            <tr class="collapse" id="my_detail_rf_max_depth">
                                <td colspan="4">
                                    <p>Increasing this value will make the model more complex and more likely to
                                        overfit;</p>
                                </td>
                            </tr>
                            <!--min_samples_leaf-->
                            <tr>
                                <td>min samples leaf</td>
                                <td><select class="form-control" name="min_samples_leaf_method" style="width: 80%">
                                    <option>uniformint</option>
                                    <option>randint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="1" name="min_samples_leaf">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[1, 9999]</kbd> The minimum number of samples required to be at a leaf
                                        node;
                                        <!--min_samples_leaf建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_min_samples_leaf" aria-expanded="true"
                                           aria-controls="my_detail_min_samples_leaf">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--min_samples_leaf建议-->
                            <tr class="collapse" id="my_detail_min_samples_leaf">
                                <td colspan="4">
                                    <p>Increasing this value will make the model less complex and less likely to
                                        overfit;;</p>
                                </td>
                            </tr>
                            <!--min_samples_split-->
                            <tr>
                                <td>min samples split</td>
                                <td><select class="form-control" name="min_samples_split_method" style="width: 80%">
                                    <option>uniformint</option>
                                    <option>randint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="2" name="min_samples_split">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Integer</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[2, 9999]</kbd> The minimum number of samples required to split an internal
                                        node;
                                        <!--min_samples_split建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_min_samples_split" aria-expanded="true"
                                           aria-controls="my_detail_min_samples_split">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--min_samples_split建议-->
                            <tr class="collapse" id="my_detail_min_samples_split">
                                <td colspan="4">
                                    <p>Increasing this value will make the model less complex and less likely to
                                        overfit;</p>
                                </td>
                            </tr>
                            <!--min_impurity_decrease-->
                            <tr>
                                <td>min impurity decrease</td>
                                <td><select class="form-control" name="min_impurity_decrease_method" style="width: 80%">
                                    <option>uniform</option>
                                    <option>loguniform</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="0.0" name="min_impurity_decrease">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">Float</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[0, 9999]</kbd> The minimum number of samples required to split an internal
                                        node;
                                        <!--min_impurity_decrease建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_min_impurity_decrease" aria-expanded="true"
                                           aria-controls="my_detail_min_impurity_decrease">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--min_impurity_decrease建议-->
                            <tr class="collapse" id="my_detail_min_impurity_decrease">
                                <td colspan="4">
                                    <p>Increasing this value will make the model less complex and less likely to
                                        overfit;</p>
                                </td>
                            </tr>
                            <!--max_features-->
                            <tr>
                                <td>max features</td>
                                <td><select class="form-control" name="max_features_method" style="width: 80%">
                                    <option>choice</option>
                                    <option>uniformint</option>
                                </select></td>
                                <td>
                                    <div class="form-group" style="margin: 0">
                                        <div class="input-group" style="width: 100%">
                                            <input class="form-control" value="sqrt" name="max_features">
                                            <!--加入符号-->
                                            <div class="input-group-addon" style="width: 90px">StrOrInt</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <p class="text-justify" style="margin-bottom: 0">
                                        <kbd>[sqrt, log2]&cup;[1, 19999]</kbd> The number of features to consider when
                                        looking for the best split;
                                        <!--max_features建议链接-->
                                        <a role="button" data-toggle="collapse" data-parent="#accordion"
                                           href="#my_detail_max_features" aria-expanded="true"
                                           aria-controls="my_detail_max_features">
                                            [suggestion...]
                                        </a>
                                    </p>
                                </td>
                            </tr>
                            <!--max_features建议-->
                            <tr class="collapse" id="my_detail_max_features">
                                <td colspan="4">
                                    <p>Decreasing this value will make the model less complex and less likely to
                                        overfit;</p>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--example-->
                <div class="panel-footer" style="font-size: 18px;padding: 12px 18px">
                    <strong>Example:</strong>
                    <a href="{% url 'cal_queue:example_download' 'descriptor_file' %}">Descriptor</a>
                    |
                    <a href="{% url 'cal_queue:result_show' "b'p\xf4\xd1qb\xe7\x1c\x9a\xaaT\xf2\xb1,\xeaoI'cadd" %}">Result</a>
                </div>
            </div>
        </div>
        <!--提交任务行-->
        <div class="row">
            <!--提交任务-->
            <div class="col-sm-6 col-sm-offset-3 text-center">
                <div class="btn-group" role="group" aria-label="...">
                    <!--隐藏/显示设置框按钮-->
                    <button class="btn btn-primary btn-lg" type="button" data-toggle="collapse"
                            data-target="#my_model_parameter_table" aria-expanded="false"
                            aria-controls="my_model_parameter_table">
                        Settings
                    </button>
                    <button type="submit" id="submit_button" class="btn btn-success btn-lg">Submit</button>
                </div>
            </div>
        </div>
    </form>
    <br/><br/><br/><br/>
{% endblock %}
<!--js-->
{% block js %}
    <script type="text/javascript">
        $(function () {
            /*modelling 首次进入页面隐藏未被选中的表单*/
            $('#algo_select :not(option:selected)').each(function () {
                if ($(this).val() === 'Support Vector Machine') {
                    $('#svm').hide()
                }
                if ($(this).val() === 'eXtreme Gradient Boosting') {
                    $('#xgb').hide()
                }
                if ($(this).val() === 'Random Forest') {
                    $('#rf').hide()
                }
            });
            /*modelling 根据选择显示不同表单*/
            hyper_table();
            /*modelling 提交任务时删除未被选中的表单*/
            remove_form();
            //插件对表单验证
            $('form').bootstrapValidator({
                message: 'This value is not valid',
                excluded: [':disabled', ':hidden'],
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    //描述符文件
                    descriptor_file: {
                        validators: {
                            notEmpty: {
                                message: 'Upload at least one descriptor file in csv format'
                            },
                            file: {
                                message: 'The file is not valid',
                                // 1024*1024 = 1MB
                                minSize: 0.008 * 1024 * 1024,  //最小8KB
                                maxSize: 10000 * 1024 * 1024,  //最大10GB
                            },
                            regexp: {
                                regexp: /.csv$/,
                                message: 'file extension error'
                            },
                        }
                    },
                    //训练集比例校验
                    train_size: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^\d+(\.?\d+)?$/,
                                message: 'This value is not valid'
                            },
                            greaterThan: {
                                value: 0.5
                            },
                            lessThan: {
                                value: 1
                            }
                        }
                    },
                    //邮箱格式校验
                    my_email: {
                        validators: {
                            emailAddress: {
                                message: 'The input is not a valid email address'
                            }
                        }
                    },
                    // 特征选择器 参数
                    feature_selector_para: {
                        validators: {
                            notEmpty: {},
                            digits: {},
                            greaterThan: {
                                value: 1
                            },
                            lessThan: {
                                value: 10000
                            }
                        }
                    },
                    //max_eval
                    max_eval: {
                        validators: {
                            notEmpty: {},
                            digits: {},
                            greaterThan: {
                                value: 0
                            },
                            lessThan: {
                                value: 1000
                            },
                        }
                    },
                    //xgb
                    //n_estimators
                    n_estimators: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^[1-9]\d{0,3}(-[1-9]\d{0,3})?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //learning rate
                    learning_rate: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /((^0\.\d+)(-((0\.\d+)|1))?$|^1$)/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //subsample
                    subsample: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /((^0\.\d+)(-((0\.\d)|1))?$|^1$)/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //max_depth
                    max_depth: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^[1-9]\d{0,3}(-[1-9]\d{0,3})?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //gamma
                    gamma: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^(\d{1,4}|(\d+\.\d{1,4}))?(-\d+(\.\d{1,4})?)?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //min_child_weight
                    min_child_weight: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^\d{1,4}(\.\d{1,4})?(-\d+(\.\d{1,4})?)?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //colsample_bytree
                    colsample_bytree: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /((^0\.\d+)(-((0\.\d)|1))?$|^1$)/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //colsample_bylevel
                    colsample_bylevel: {
                        validators: { 
                            notEmpty: {},
                            regexp: {
                                regexp: /((^0\.\d+)(-((0\.\d)|1))?$|^1$)/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //colsample_bynode
                    colsample_bynode: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /((^0\.\d+)(-((0\.\d)|1))?$|^1$)/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //reg_alpha
                    reg_alpha: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^\d{1,4}(\.\d{1,4})?(-\d+(\.\d{1,4})?)?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //reg_lambda
                    reg_lambda: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^\d{1,4}(\.\d{1,4})?(-\d+(\.\d{1,4})?)?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //svm
                    //C
                    C: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^(\d{1,4}|(\d+\.\d{1,4}))?(-\d+(\.\d{1,4})?)?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //rf
                    //min_samples_leaf
                    min_samples_leaf: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^[1-9]\d{0,3}(-[1-9]\d{0,3})?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //min_samples_split
                    min_samples_split: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^[2-9]\d{0,3}(-[1-9]\d{0,3})?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //min_impurity_decrease
                    min_impurity_decrease: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /^\d+(\.\d{1,4})?(-\d+(\.\d{1,4})?)?$/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                    //max_features
                    max_features: {
                        validators: {
                            notEmpty: {},
                            regexp: {
                                regexp: /((^sqrt$)|(^log2$)|(^1\d{0,4}?(-1\d{0,4}?)?$))|(^sqrt-log2$)|(^log2-sqrt$)/,
                                message: 'This value is not valid'
                            },
                        }
                    },
                }
            });
        });

        /*modelling 根据选择显示不同表单*/
        function hyper_table() {
            $('#algo_select').click(function () {
                //全部隐藏
                $('.my_hyper').hide();
                $('#my_all_modelling').show();
                var selected = $('#algo_select option:selected').val();
                //显示被勾选的模型参数并去除禁用
                if (selected === 'Support Vector Machine') {
                    $('#svm').show();
                }
                if (selected === 'eXtreme Gradient Boosting') {
                    $('#xgb').show();
                }
                if (selected === 'Random Forest') {
                    $('#rf').show();
                }
                if (selected === 'No Modelling') {
                    $('#my_all_modelling').hide()
                }
            })
        }

        /*modelling 提交任务时删除未被选中的表单*/
        function remove_form() {
            $('#submit_button').click(function () {
                $('#algo_select :not(option:selected)').each(function () {
                    if ($(this).val() === 'Support Vector Machine') {
                        $('#svm').remove()
                    }
                    if ($(this).val() === 'eXtreme Gradient Boosting') {
                        $('#xgb').remove()
                    }
                    if ($(this).val() === 'Random Forest') {
                        $('#rf').remove()
                    }
                });
            })
        }
    </script>
{% endblock %}

